---
title: ""
geometry: textwidth=18cm,textheight=21cm
setspace: doublespacing
lang: pt-br
header-includes:
- \usepackage{setspace}
- \usepackage{indentfirst}
- \usepackage[utf8]{inputenc}
- \usepackage{mathptmx}
- \usepackage{enumerate}
- \usepackage{url} 
- \usepackage{lipsum}
output:
  pdf_document:
  html_document: default
  fig_caption: yes
  mainfont: Times New Roman
  
fontsize: 10pt

---

\begin{titlepage}
\begin{center}
\thispagestyle{empty}
\begin{figure}[!htb]
\begin{center}
\begin{minipage}[b]{0.5\linewidth}
\begin{center}
\includegraphics[width=100pt,height=150pt]{logo/logoimeccunicamp.png}
\end{center}
\end{minipage}
\begin{minipage}[b]{0.7\linewidth}
\begin{center}
\vspace*{1cm}
 {\large \bf Universidade Estadual de Campinas\\[5pt]
Instituto de Matemática, Estatística e Computação Cientifica\\[3pt]
Departamento de Estatística}
\end{center}
\end{minipage}
\end{center}
\end{figure}
\vspace*{\stretch{1}}
\begin{center}
\vspace*{5cm}
{\huge \bf Relatório - Parte I \\[7pt]
Trabalho Final de ME613}
\end{center}
\vspace*{\stretch{1}}
\begin{center}
\vspace*{4cm}
{\Large \bf Eliane Ramos de Siqueira  RA:155233 \\
Guilherme Pazian  RA:160323 \\
Henrique Capatto  RA:146406 \\
Murilo Salgado Razoli  RA:150987 \break
}\\[3pt]
{\large \bf Professor: Caio Lucidius Naberezny Azevedo}\\[5pt]
\end{center}
\vspace*{\stretch{1}}
\centerline{\bf Campinas-SP, 06 de Dezembro de 2016}
\vspace*{\stretch{1}}
\end{center}
\end{titlepage}

\onehalfspacing
\newpage

```{r pacotes,cache = TRUE,echo=FALSE, warning = FALSE, error = FALSE}
# pacote utiliado para gráficos
library(ggplot2)
# pacote que deixa os gráficos do ggplot lado a lado
library(gridExtra)
# pacotes para manipulação de dados
library(reshape2)
library(plyr)
library(dplyr)
#pacote que possui o conjunto de dados para o primeiro exercício
library(car)
#pacote para fazer legenda
library(captioner)



figs <- captioner(prefix="Figura")
tbls <- captioner(prefix="Tabela")

#inslação dos pacotes necessários
#install.packages(C("tidyverse","gridExtra","car","captioner","gvlma"))

#instalacao de um pacote pra "printar" tabelas mais bonitinhas
#install.packages(
#  'printr',
#  type = 'source',
#  repos = c('http://yihui.name/xran', 'http://cran.rstudio.com')
#)

```

```{r gráficos de resíduos,cache = TRUE,echo=FALSE}

# Programa extraído do site: https://www.ime.usp.br/~giapaula/textoregressao.htm
# Créditos: Prof. Dr. Gilberto Alvarenga Paula
# Adaptado por Caio L. N. Azevedo
# source("C:\\Users\\cnaber\\Trabalho\\windows\\Unicamp\\Disciplinas\\2_semestre_2016\\ME 613\\Programas\\diag2_norm.r")


diag2norm<-function(fit.model){
# fit.model: objeto com o ajuste do modelo normal linear homocedástico 
# obtido através da função "lm"

par(mfrow=c(2,2))
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
H <- X%*%solve(t(X)%*%X)%*%t(X)
h <- diag(H)
lms <- summary(fit.model)
s <- lms$sigma
r <- resid(lms)
ts <- r/(s*sqrt(1-h))
di <- (1/p)*(h/(1-h))*(ts^2)
si <- lm.influence(fit.model)$sigma
tsi <- r/(si*sqrt(1-h))
a <- max(tsi)
b <- min(tsi)
par(mfrow=c(2,2))
#
plot(tsi,main = "A",xlab="Índice", ylab="Resíduo Studentizado",
ylim=c(b-1,a+1), pch=16,cex=1.1,cex.axis=1.1,cex.lab=1.1)
abline(2,0,lty=2)
abline(-2,0,lty=2)
abline(0,0,lty=2)
#identify(tsi, n=1)
#title(sub="(c)")
#
plot(fitted(fit.model),main = "B",tsi,xlab="Valores Ajustados", 
ylab="Resíduo Studentizado", ylim=c(b-1,a+1), pch=16,cex=1.1,cex.axis=1.1,cex.lab=1.1)
#
abline(2,0,lty=2)
abline(-2,0,lty=2)
abline(0,0,lty=2)
#boxplot(tsi,ylab="Resíduo Studentizado",cex=1.1,cex.axis=1.1,cex.lab=1.1)
hist(tsi,xlab="Resíduo Studentizado",ylab="densidade",probability=TRUE,main="C",cex=1.1,cex.axis=1.1,cex.lab=1.1)
#title(sub="(d)")
#identify(fitted(fit.model),tsi, n=1)
#
boxplot(tsi,main = "D",ylab="Resíduo Studentizado",cex=1.1,cex.axis=1.1,cex.lab=1.1)

#---------------------------------------------------------------#

}

# Programa extraído do site: https://www.ime.usp.br/~giapaula/textoregressao.htm
# Créditos: Prof. Dr. Gilberto Alvarenga Paula
# Adaptado por Caio L. N. Azevedo

envelnorm<-function(fit.model){
# fit.model: objeto com o ajuste do modelo normal linear homocedástico 
# obtido através da função "lm"

#par(mfrow=c(1,1))
X <- model.matrix(fit.model)
n <- nrow(X)
p <- ncol(X)
H <- X%*%solve(t(X)%*%X)%*%t(X)
h <- diag(H)
si <- lm.influence(fit.model)$sigma
r <- resid(fit.model)
tsi <- r/(si*sqrt(1-h))
#
ident <- diag(n)
epsilon <- matrix(0,n,100)
e <- matrix(0,n,100)
e1 <- numeric(n)
e2 <- numeric(n)
#
for(i in 1:100){
     epsilon[,i] <- rnorm(n,0,1)
     e[,i] <- (ident - H)%*%epsilon[,i]
     u <- diag(ident - H)
     e[,i] <- e[,i]/sqrt(u)
     e[,i] <- sort(e[,i]) }
#
for(i in 1:n){
     eo <- sort(e[i,])
     e1[i] <- (eo[2]+eo[3])/2
     e2[i] <- (eo[97]+eo[98])/2 }
#
med <- apply(e,1,mean)
faixa <- range(tsi,e1,e2)
#
#par(pty="s")
qqnorm(tsi,xlab="Percentil da N(0,1)",
ylab="Residuo Studentizado", ylim=faixa, pch=16, main="",cex=1.1,cex.axis=1.1,cex.lab=1.1)

par(new=T)
qqnorm(e1,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=1, main="")
par(new=T)
qqnorm(e2,axes=F,xlab="",ylab="", type="l",ylim=faixa,lty=1, main="")
par(new=T)
qqnorm(med,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=2, main="")
#------------------------------------------------------------#

}

```

```{r Teste Cbeta, cache=TRUE, echo=FALSE}
# fit.model: saída do modelo ajustado
# m.C: matriz C relativa às hipóteses de interesse

testeF.CB <- function(fit.model,m.C)
{
v.beta <-  cbind(fit.model$coef) # vetor com a estimativa dos parâmetros
n <- nrow(model.matrix(fit.model)) # número de observações
e.p <- nrow(v.beta) # número de parâmetros
e.q <- nrow(m.C)  # número de linhas da matriz C
m.cov.beta <- (vcov(fit.model)) # matriz de covariâncias dos parâmetros do modelo
# Estatística do Teste
e.F <- t(m.C%*%v.beta)%*%solve(m.C%*%m.cov.beta%*%t(m.C))%*%(m.C%*%v.beta)/e.q
e.pvalor <- 1-pf(e.F,e.q,n-e.p) # p-0valor
cat("Estatistica F = ",round(e.F,2),"\n")
cat("pvalor = ",round(e.pvalor,4),"\n")
cat("Matriz C :","\n")
print(m.C)
}

# fit.model: saída do modelo ajustado
# m.C: matriz C relativa às hipóteses de interesse
#m.M : matriz M relativa às hipóteses de interesse
testeF.CBM <- function(fit.model,m.C,m.M)

{
v.beta <-  cbind(fit.model$coef) # vetor com a estimativa dos parâmetros
n <- nrow(model.matrix(fit.model)) # número de observações
e.p <- nrow(v.beta) # número de parâmetros
e.q <- nrow(m.C)  # número de linhas da matriz C
m.cov.beta <- (vcov(fit.model)) # matriz de covariâncias dos parâmetros do modelo
# Estatística do teste
e.F <- t(m.C%*%v.beta-m.M)%*%solve(m.C%*%m.cov.beta%*%t(m.C))%*%(m.C%*%v.beta-m.M)/e.q
e.pvalor <- 1-pf(e.F,e.q,n-e.p) # p-valor
cat("Estatistica F = ",round(e.F,2),"\n")
cat("pvalor = ",round(e.pvalor,4),"\n")
cat("Matriz C :","\n")
print(m.C)
cat("Matriz M :","\n")
print(m.M)

}

```

```{r legendas, echo=FALSE, cache=TRUE}
#legenda para as tabelas

# legenda para a primeira tabela(estats descr) do primeiro exercício
legenda_table1 = tbls(name="table_estat_descr1",caption = "Estatísticas Descritivas")



#legendas para os gráficos

#legenda para o primeiro Boxplot
legenda_graf1 = figs(name="graf1_boxplot",caption = "Boxplot Comparativo")
#legenda para o primeiro grárico de dispersão
legenda_graf2 = figs(name="graf2_dispersao",caption = "Dispersão entre as variáveis Altura e Peso")
legenda_graf3 = figs(name="graf3_dispersao",caption = "Dispersão entre as variáveis Altura e Peso considerando o sexo.")
```

\begin{enumerate}
\item Introdução
\end{enumerate}
\vspace{0.3cm}
\setlength{\parindent}{3em}
  <p>O conjunto de dados analisado corresponde a informações de homens e mulheres envolvidos em exercícios regulares e apresenta para cada indivíduo, o peso(em kg) e altura(em cm) medidos e informados pelo mesmo. Além disso, o sexo de cada indivíduo também foi coletado, sendo que 112 são do sexo feminino e 88 são do sexo masculino, totalizando 200 pessoas.Os dados podem ser encontrados no R no pacote car, sob o nome "Davis".</p>\par
<p>O objetivo é estudar o impacto da altura no peso, levando em consideração o sexo.</p>
  <p>Utilizamos a metodologia dos modelos normais lineares homocedásticos, metodologias da qualidade do ajuste e comparação de modelos apropriados com o suporte computacional do R.</p>
</p>

\vspace{1.5cm}

```{r manipulacao_dados_exercicio_1, cache = TRUE ,echo = FALSE}
#retirada da observacao 12 e pegando só as variaveis sexo, peso e altura
dados_1 = Davis[-12,1:3]
names(dados_1)=c("Sexo","Peso","Altura")

df <- melt(dados_1,id.vars = 1)

Altf = subset(dados_1,Sexo=="F")
Altm = subset(dados_1,Sexo=="M")

Sexo = c(rep("F",nrow(Altf)),rep("M",nrow(Altm)))
Peso = c(Altf$Peso,Altm$Peso)
Altura = c(Altf$Altura,Altm$Altura)

Alturamf = (Altura-mean(Altura))
```

\begin{enumerate}
\setcounter{enumi}{1}
\item Análise descritiva
\end{enumerate}
\vspace{0.3cm}

Observando a tabela 1, podemos ver que em média, o peso e a altura dos homens são maiores que os das mulheres. Além disso vemos valores superiores em todas as estatísticas, para os homens, incluindo uma maior variação nos dados, variação essa, mostrada pelos valores de erro padrão.  

\vspace{1cm}
\begin{center}
`r legenda_table1`
\end{center}


```{r,cache = TRUE,echo=FALSE}
#estatísticas
library(printr)

df <- melt(dados_1,id.vars = 1)
resumo <- ddply(df, c("Sexo","variable"), function(x) summary(x$value))
dp = ddply(df, c("Sexo","variable"), function(x) sd(x$value))
estat_descr = data.frame(resumo,dp[,3])

names(estat_descr)=c("Sexo","Variável","Minímo","1ºQuartil","Mediana","Média","3ºQuartil","Máximo","Erro Padrão")

estat_descr
```

\vspace{0.5cm}
A figura 1 mostra um boxplot dos valores de peso por gênero e um boxplot dos valores de altura também por gênero. Observando-os podemos confirmar os padrões já identificados pelas estatísticas descritivas.

```{r graf_box_1,cache = TRUE,echo=FALSE, fig.height=3, fig.width=6,fig.align='center'}
#gráficos
# boxplot sexo x peso
graf1 = ggplot(dados_1, aes(Sexo,Peso,fill=Sexo))
graf1 = graf1+geom_boxplot()+labs(title = "Boxplot: Sexo x Peso" , x = "Sexo", y="Peso")

# boxplot sexo x altura
graf2 = ggplot(dados_1, aes(Sexo,Altura,fill=Sexo))
graf2 = graf2 + geom_boxplot()+labs(title = "Boxplot: Sexo x Altura" , x = "Sexo", y="Altura")

grid.arrange(graf1, graf2, nrow=1, ncol=2)
```
\begin{center}
`r legenda_graf1`
\end{center}

\vspace{0.5cm}
Na figura 2 abaixo, temos um gráfico de dispersão do peso em relação a altura dos indivíduos, desconsiderando o gênero. Podemos perceber que há uma relação positiva entre a váriavel resposta(peso) e a variável explicativa(altura), isto é, quanto maior a altura, maior o peso do indivíduo. Tal relação pode ser razoavelmente representada por uma reta ou uma curva quadrática.

\vspace{0.6cm}
```{r disp_11, cache=TRUE,echo = FALSE,fig.align='center',fig.width=5.5,fig.height=3.4,warning=FALSE}
# Dispersão entre Altura e Peso (Desconsiderando o sexo)
graf3 = ggplot(dados_1, aes(Altura,Peso))
graf3+geom_point()+labs(title = "Dispersão entre as variáveis Altura e Peso" , x = "Altura", y="Peso")+theme(plot.title = element_text(hjust = 0.5))
```
\begin{center}
`r legenda_graf2`
\end{center}

A figura 3 também apresenta os gráficos de dispersão entre a variável resposta e explicativa, desta vez considerando o sexo de cada indivíduo.
Podemos ver que para ambos os sexos,há uma relação positiva, o peso cresce a medida que a altura cresce. Além disso é possível notar a presença de um outlier para o sexo masculino, enquanto que para o sexo feminino podemos ver em torno de três outliers.
Tanto para o sexo feminino quanto o masculino podemos ainda razoavelmente representar esta relação entre peso e altura por uma reta ou uma curva quadrática.

\vspace{0.5cm}
```{r disp_12, cache=TRUE,echo = FALSE,fig.width=5.5,fig.height=3.5,fig.align='center', warning=FALSE}
# Dispersão entre Altura e Peso (feminino)
graf4= ggplot(Altf, aes(Altura,Peso))
graf4=graf4+geom_point()+labs(title = "Sexo Feminino" , x = "Altura", y="Peso")+theme(plot.title = element_text(hjust = 0.5))

# Dispersão entre Altura e Peso (masculino)
graf5 = ggplot(Altm, aes(Altura,Peso))
graf5 = graf5+geom_point()+labs(title = "Sexo Masculino" , x = "Altura", y="Peso")+theme(plot.title = element_text(hjust = 0.5))
grid.arrange(graf4, graf5, nrow=1, ncol=2)
```
\begin{center}
`r legenda_graf3`
\end{center}

\vspace{0.5cm}
\begin{enumerate}
\setcounter{enumi}{2}
\item Análise Inferencial
\end{enumerate}
\vspace{0.3cm}
  Devido ao objetivo em questão e aos resultados da análise descritiva, vamos considerar os seguintes modelos:
  
  colocar os modelos, analise de residuo e bla bla bla

\vspace{0.5cm}
\begin{enumerate}
\setcounter{enumi}{3}
\item Conclusões
\end{enumerate}
\vspace{0.3cm}

escrever conclusões<p>
escrever conclusões<p>
escrever conclusões<p>
escrever conclusões
escrever conclusões
escrever conclusões
\vspace{0.5cm}


\begin{enumerate}
\setcounter{enumi}{4}
\item Referências Bibliográficas
\end{enumerate}

\vspace{0.3cm}
\begin{itemize}
  \item Azevedo, C. L. N (2016). Notas de aula sobre planejamento e análise de experimentos,\url{http://www.ime.unicamp.br/~cnaber/Material_ME613_2S_20
16.htm}
  \item Faraway, J. J. (2014). Linear Models with R, Second Edition,Chapman e Hall/CRC Texts in Statistical Science
  \item Draper, N. R. and Smith, H. (1998). Applied regression analysis, third edition. New York, NY: John Wiley e Sons.
  \item Paula, G. A. (2013). Modelos de regressão com apoio computacional, versão pré-eliminar \url{ https://www.ime.usp.br/~giapaula/texto_2013.pdf}
  
\end{itemize}

\vspace{0.5cm}

\begin{enumerate}
\setcounter{enumi}{5}
\item Apêndice
\end{enumerate}
\vspace{0.3cm}


